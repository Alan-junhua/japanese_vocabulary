<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>收藏单词</title>
  <link rel="stylesheet" href="/static/css/styles.css" />
  <style>
    .container { max-width: 960px; margin: 40px auto; padding: 0 16px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #e5e7eb; }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <h2>⭐ 收藏单词</h2>
    <p><a href="/">返回首页</a></p>
    <p style="color:#4b5563;">提示：在平假名测试中做错的题目会自动加入此列表。</p>

    <div id="msg" style="margin: 10px 0; color: #dc2626;"></div>

    <table id="notesTable" style="margin-top: 10px;">
      <thead>
        <tr>
          <th>单词</th>
          <th>读音</th>
          <th>中文意思</th>
          <th>课次</th>
          <th>错误次数</th>
          <th>最后错误时间</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const msgEl = document.getElementById('msg');
    const tbody = document.querySelector('#notesTable tbody');

    async function loadNotes() {
      msgEl.textContent = '';
      tbody.innerHTML = '';
      try {
        const res = await fetch('/api/user_notes');
        const data = await res.json();
        if (!data.ok) { msgEl.textContent = data.message || '加载失败'; return; }
        const notes = data.notes || [];
        if (notes.length === 0) { msgEl.textContent = '暂无收藏单词'; return; }
        tbody.innerHTML = notes.map(n => `
          <tr>
            <td>${n.word || ''}</td>
            <td>${n.hiragana || ''}</td>
            <td>${n.meaning || ''}</td>
            <td>${n.lesson || ''}</td>
            <td>${n.wrongCount || 0}</td>
            <td>${n.lastWrongAt || ''}</td>
            <td><button data-word="${n.word}">删除</button></td>
          </tr>
        `).join('');

        tbody.querySelectorAll('button').forEach(btn => {
          btn.addEventListener('click', async () => {
            const word = btn.getAttribute('data-word');
            if (!word) return;
            if (!confirm(`确认删除 “${word}” 吗？`)) return;
            btn.disabled = true;
            try {
              const res = await fetch('/api/user_notes/delete', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ word })
              });
              const data = await res.json();
              if (!data.ok) {
                msgEl.textContent = data.message || '删除失败';
                btn.disabled = false;
                return;
              }
              loadNotes();
            } catch (e) {
              msgEl.textContent = '请求异常：' + e;
              btn.disabled = false;
            }
          });
        });
      } catch (e) {
        msgEl.textContent = '请求异常：' + e;
      }
    }

    loadNotes();
  </script>
</body>
</html>



