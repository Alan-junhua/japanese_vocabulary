# 日语学习系统 - 打包说明

## 概述

本项目使用PyInstaller将Python Flask应用打包成独立可执行文件，可以在没有Python环境的Windows电脑上运行。

## 打包步骤

### 1. 安装依赖

确保已安装所有必要的依赖：

```bash
pip install -r requirements.txt
```

或者单独安装PyInstaller：

```bash
pip install pyinstaller
```

### 2. 执行打包

有两种方式可以打包：

#### 方式一：使用打包脚本（推荐）

```bash
python build_exe.py
```

打包脚本会自动：
- 检查PyInstaller是否已安装
- 清理之前的构建文件
- 执行打包
- 复制数据库文件
- 创建使用说明文件

#### 方式二：使用PyInstaller直接打包

```bash
pyinstaller japanese_learning.spec --clean --noconfirm
```

### 3. 打包结果

打包完成后，会在`dist`目录下生成：
- `日语学习系统.exe` - 主程序文件
- `使用说明.txt` - 使用说明文件
- `japanese_learning.db` - 数据库文件（如果存在）

## 文件说明

### 打包配置文件

- `japanese_learning.spec` - PyInstaller配置文件
  - 定义了需要包含的文件和模块
  - 配置了可执行文件的名称和选项

### 打包脚本

- `build_exe.py` - 自动化打包脚本
  - 自动检查依赖
  - 清理构建文件
  - 执行打包
  - 复制必要文件

## 打包后的文件结构

```
dist/
├── 日语学习系统.exe      # 主程序
├── japanese_learning.db  # 数据库文件（如果存在）
└── 使用说明.txt          # 使用说明
```

## 分发说明

### 必需文件

打包后，以下文件需要一起分发：

1. **日语学习系统.exe** - 主程序（必需）
2. **japanese_learning.db** - 数据库文件（可选，如果不存在程序会创建）
3. **使用说明.txt** - 使用说明（可选）

### 注意事项

1. **数据库文件**：
   - 数据库文件包含所有单词和学习记录
   - 如果数据库文件不存在，程序会自动创建
   - 学习记录会保存在数据库文件中
   - 请妥善保管数据库文件，避免丢失学习记录

2. **文件位置**：
   - 所有文件应放在同一目录下
   - 数据库文件应与可执行文件在同一目录
   - 用户可以自由移动整个文件夹

3. **端口占用**：
   - 程序默认使用5000端口
   - 如果5000端口被占用，程序可能无法启动
   - 可以关闭占用端口的其他程序，或修改代码中的端口号

4. **防火墙和杀毒软件**：
   - 首次运行可能被防火墙或杀毒软件拦截
   - 需要允许程序通过防火墙
   - 如果被杀毒软件误报，需要添加信任

## 运行说明

### 用户使用

1. 双击运行`日语学习系统.exe`
2. 程序会自动启动Web服务器
3. 浏览器会自动打开 http://127.0.0.1:5000
4. 如果浏览器未自动打开，请手动访问上述地址
5. 关闭程序窗口即可退出程序

### 开发环境

开发环境下，可以直接运行：

```bash
python web_app.py
```

## 常见问题

### 1. 打包失败

**问题**：打包时出现错误

**解决方法**：
- 检查是否安装了所有依赖
- 检查PyInstaller版本是否兼容
- 查看错误信息，根据提示解决问题

### 2. 程序无法启动

**问题**：双击程序后没有反应

**解决方法**：
- 检查防火墙设置
- 检查杀毒软件是否拦截
- 检查端口是否被占用
- 查看控制台输出的错误信息

### 3. 数据库文件找不到

**问题**：程序提示找不到数据库文件

**解决方法**：
- 确保数据库文件与可执行文件在同一目录
- 检查文件权限
- 如果数据库文件不存在，程序会自动创建

### 4. 端口被占用

**问题**：程序提示端口被占用

**解决方法**：
- 关闭占用5000端口的其他程序
- 或修改代码中的端口号（需要重新打包）

## 技术细节

### 路径处理

打包后的程序使用以下路径处理机制：

1. **模板和静态文件**：
   - 从PyInstaller临时目录（`sys._MEIPASS`）加载
   - 这些文件会被打包到可执行文件中

2. **数据库文件**：
   - 从可执行文件所在目录读取
   - 数据库文件不会被打包，方便用户数据持久化

3. **路径检测**：
   - 使用`sys.frozen`判断是否为打包后的程序
   - 根据不同情况使用不同的路径

### 依赖包含

PyInstaller会自动检测并包含以下依赖：
- Flask及其依赖
- SQLite3（Python内置）
- 项目自定义模块

### 文件大小

打包后的可执行文件大小约：
- 不包含数据库：约50-100MB
- 包含所有依赖：约100-200MB

## 更新说明

### 更新程序

1. 重新打包程序
2. 替换可执行文件
3. 保留数据库文件（如果不想丢失数据）

### 更新数据库

1. 备份现有数据库文件
2. 替换数据库文件
3. 重启程序

## 许可证

本项目遵循原项目的许可证。

## 联系方式

如有问题或建议，请联系项目维护者。

